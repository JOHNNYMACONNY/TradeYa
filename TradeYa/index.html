<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaboration Project Management</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script type="module">
        // Import Firebase modules from CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, setDoc, doc, getDoc, addDoc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCCr7wxWHJyv4C9pGOJ0Juf7latDmceTew",
            authDomain: "tradeya-45ede.firebaseapp.com",
            projectId: "tradeya-45ede",
            storageBucket: "tradeya-45ede.firebasestorage.app",
            messagingSenderId: "476911238747",
            appId: "1:476911238747:web:e9b73b157f3fa63ba4897e",
            measurementId: "G-XNL1Y7CZWW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Fetch Data from Firestore
        async function fetchData(collectionName) {
            try {
                const docRef = doc(db, collectionName, 'data');
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    return docSnap.data();
                } else {
                    console.log("No such document!");
                    return {};
                }
            } catch (error) {
                console.error('Error fetching data: ', error);
                return {};
            }
        }

        // Load Data
        async function loadTeamMembers() {
            const data = await fetchData('teamMembers');
            const teamMembers = data.teamMembers || [];
            populateTeamTable(teamMembers);
        }

        async function loadTasks() {
            const data = await fetchData('tasks');
            const tasks = data.tasks || [];
            populateTaskList(tasks);
        }

        async function loadCollabProjects() {
            const data = await fetchData('collabProjects');
            const collabProjects = data.collabProjects || [];
            populateCollabList(collabProjects);
            populateCompletedCollabList(collabProjects);
        }

        // Populate Team Members
        function populateTeamTable(teamMembers) {
            const teamList = document.getElementById("team-list");
            teamList.innerHTML = ""; // Clear existing rows
            teamMembers.forEach((member, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td contenteditable="false">${member.name}</td>
                    <td contenteditable="false">${member.skills}</td>
                    <td contenteditable="false">${member.needs}</td>
                    <td contenteditable="false"><a href="${member.portfolio}" target="_blank">${member.portfolio}</a></td>
                    <td contenteditable="false">${member.contact}</td>
                    <td>
                        <button onclick="contactMember('${member.contact}')">Contact</button>
                        <button onclick="editMember(${index})">Edit</button>
                        <button onclick="saveMember(${index})" style="display:none;">Save</button>
                        <button onclick="deleteMember(${index})">Delete</button>
                    </td>
                `;
                teamList.appendChild(row);
            });
        }

        // Populate Task List
        function populateTaskList(tasks) {
            const taskList = document.getElementById("task-list");
            taskList.innerHTML = ""; // Clear existing tasks
            tasks.forEach((task, index) => {
                const taskItem = document.createElement("li");
                taskItem.className = "list-group-item";
                taskItem.innerHTML = `
                    <h3>${task.title}</h3>
                    <p>${task.description}</p>
                    <p>Requested by: ${task.requester}</p>
                    <p>Contact: ${task.contact}</p>
                    <button onclick="editTask(${index})">Edit</button>
                    <button onclick="saveTask(${index})" style="display:none;">Save</button>
                    <button onclick="deleteTask(${index})">Delete</button>
                `;
                taskList.appendChild(taskItem);
            });
        }

        // Populate Collaboration Projects List
        function populateCollabList(collabProjects) {
            const collabList = document.getElementById("collab-list");
            collabList.innerHTML = ""; // Clear existing projects
            collabProjects.forEach((project, index) => {
                const positions = Array.isArray(project.positions) ? project.positions.map(pos => pos.name).join(', ') : 'N/A';
                const projectItem = document.createElement("li");
                projectItem.className = "list-group-item";
                projectItem.innerHTML = `
                    <h3>${project.title}</h3>
                    <p>${project.description}</p>
                    <p>Positions Needed: ${positions}</p>
                    <button onclick="editCollab(${index})">Edit</button>
                    <button onclick="saveCollab(${index})" style="display:none;">Save</button>
                    <button onclick="deleteCollab(${index})">Delete</button>
                `;
                collabList.appendChild(projectItem);
            });
        }

        // Add Data to Firestore
        async function addTeamMember(member) {
            try {
                const docRef = doc(db, 'teamMembers', 'data');
                const docSnap = await getDoc(docRef);
                let teamMembers = [];
                if (docSnap.exists()) {
                    teamMembers = docSnap.data().teamMembers;
                }
                teamMembers.push(member);
                await setDoc(docRef, { teamMembers });
                loadTeamMembers();
            } catch (error) {
                console.error('Error adding team member: ', error);
            }
        }

        async function addTask(task) {
            try {
                const docRef = doc(db, 'tasks', 'data');
                const docSnap = await getDoc(docRef);
                let tasks = [];
                if (docSnap.exists()) {
                    tasks = docSnap.data().tasks;
                }
                tasks.push(task);
                await setDoc(docRef, { tasks });
                loadTasks();
            } catch (error) {
                console.error('Error adding task: ', error);
            }
        }

        async function addCollabProject(project) {
            try {
                const docRef = doc(db, 'collabProjects', 'data');
                const docSnap = await getDoc(docRef);
                let collabProjects = [];
                if (docSnap.exists()) {
                    collabProjects = docSnap.data().collabProjects;
                }
                collabProjects.push(project);
                await setDoc(docRef, { collabProjects });
                loadCollabProjects();
            } catch (error) {
                console.error('Error adding collaboration project: ', error);
            }
        }

        // Event Listeners
        document.addEventListener("DOMContentLoaded", () => {
            loadTeamMembers();
            loadTasks();
            loadCollabProjects();
        });

        document.getElementById('add-member-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const member = {
                name: document.getElementById('new-name').value,
                skills: document.getElementById('new-skills').value,
                needs: document.getElementById('new-needs').value,
                portfolio: document.getElementById('new-portfolio').value,
                contact: document.getElementById('new-contact').value
            };
            await addTeamMember(member);
        });

        document.getElementById('add-task-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const task = {
                title: document.getElementById('task-title').value,
                description: document.getElementById('task-description').value,
                requester: document.getElementById('task-requester').value,
                contact: document.getElementById('task-contact').value,
                completed: false
            };
            await addTask(task);
        });

        document.getElementById('add-collab-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const project = {
                title: document.getElementById('collab-title').value,
                description: document.getElementById('collab-description').value,
                positions: document.getElementById('collab-positions').value.split(',').map(pos => ({ name: pos.trim(), member: null })),
                steps: [],
                progress: 0,
                completed: false
            };
            await addCollabProject(project);
        });

        // Define searchUsers function
        async function searchUsers() {
            const query = document.getElementById("search-bar").value.toLowerCase();
            const docRef = doc(db, 'teamMembers', 'data');
            const docSnap = await getDoc(docRef);
            let teamMembers = [];
            if (docSnap.exists()) {
                teamMembers = docSnap.data().teamMembers;
            }
            const filteredMembers = teamMembers.filter(member =>
                member.skills.toLowerCase().includes(query) ||
                member.needs.toLowerCase().includes(query) ||
                member.name.toLowerCase().includes(query)
            );

            const teamList = document.getElementById("team-list");
            teamList.innerHTML = ""; // Clear existing rows
            filteredMembers.forEach((member, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td contenteditable="false">${member.name}</td>
                    <td contenteditable="false">${member.skills}</td>
                    <td contenteditable="false">${member.needs}</td>
                    <td contenteditable="false"><a href="${member.portfolio}" target="_blank">${member.portfolio}</a></td>
                    <td contenteditable="false">${member.contact}</td>
                    <td>
                        <button onclick="contactMember('${member.contact}')">Contact</button>
                        <button onclick="editMember(${index})">Edit</button>
                        <button onclick="saveMember(${index})" style="display:none;">Save</button>
                        <button onclick="deleteMember(${index})">Delete</button>
                    </td>
                `;
                teamList.appendChild(row);
            });
        }

        // User feedback function
        function showAlert(message, type = 'success') {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            document.body.appendChild(alert);
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // Dark Mode Toggle Functionality
        document.getElementById('dark-mode-toggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            document.querySelector('header').classList.toggle('dark-mode');
            document.querySelector('footer').classList.toggle('dark-mode');
            document.querySelectorAll('table').forEach(table => table.classList.toggle('dark-mode'));
            document.querySelectorAll('th').forEach(th => th.classList.toggle('dark-mode'));
            document.querySelectorAll('td').forEach(td => td.classList.toggle('dark-mode'));
            document.querySelectorAll('button').forEach(button => button.classList.toggle('dark-mode'));
        });
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Collab Management</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="#team-members">Team Members</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#tasks">Tasks</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#collaboration-projects">Collaboration Projects</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#ongoing-collaborations">Ongoing Collaborations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#completed-collaborations">Completed Collaborations</a>
                </li>
            </ul>
        </div>
    </nav>
    <header class="bg-dark text-white text-center py-3">
        <h1>Collaboration Project Management</h1>
        <button id="dark-mode-toggle" class="btn btn-secondary" aria-label="Toggle Dark Mode">Toggle Dark Mode</button>
    </header>
    <div class="container mt-4">
        <h2 id="team-members">Team Members</h2>
        <input type="text" id="search-bar" class="form-control mb-3" placeholder="Search members..." oninput="searchUsers()" aria-label="Search members">
        <table class="table table-striped" aria-label="Team Members Table">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Skills</th>
                    <th scope="col">Needs</th>
                    <th scope="col">Portfolio</th>
                    <th scope="col">Contact</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody id="team-list"></tbody>
        </table>

        <h3>Add New Member</h3>
        <form id="add-member-form" class="mb-4" aria-label="Add New Member Form">
            <input type="text" id="new-name" class="form-control mb-2" placeholder="Name" required aria-label="Name">
            <input type="text" id="new-skills" class="form-control mb-2" placeholder="Skills" required aria-label="Skills">
            <input type="text" id="new-needs" class="form-control mb-2" placeholder="Needs" required aria-label="Needs">
            <input type="text" id="new-portfolio" class="form-control mb-2" placeholder="Portfolio URL" required aria-label="Portfolio URL">
            <input type="email" id="new-contact" class="form-control mb-2" placeholder="Contact Email" required aria-label="Contact Email">
            <button type="submit" class="btn btn-primary">Add Member</button>
        </form>

        <h2 id="tasks">Tasks</h2>
        <ul id="task-list" class="list-group mb-4" aria-label="Task List"></ul>

        <h3>Add New Task</h3>
        <form id="add-task-form" class="mb-4" aria-label="Add New Task Form">
            <input type="text" id="task-title" class="form-control mb-2" placeholder="Task Title" required aria-label="Task Title">
            <input type="text" id="task-description" class="form-control mb-2" placeholder="Task Description" required aria-label="Task Description">
            <input type="text" id="task-requester" class="form-control mb-2" placeholder="Requested by" required aria-label="Requested by">
            <input type="email" id="task-contact" class="form-control mb-2" placeholder="Contact Email" required aria-label="Contact Email">
            <button type="submit" class="btn btn-primary">Add Task</button>
        </form>

        <h2 id="collaboration-projects">Collaboration Projects</h2>
        <ul id="collab-list" class="list-group mb-4" aria-label="Collaboration Projects List"></ul>

        <h3>Add New Collaboration Project</h3>
        <form id="add-collab-form" class="mb-4" aria-label="Add New Collaboration Project Form">
            <input type="text" id="collab-title" class="form-control mb-2" placeholder="Project Title" required aria-label="Project Title">
            <input type="text" id="collab-description" class="form-control mb-2" placeholder="Project Description" required aria-label="Project Description">
            <input type="text" id="collab-positions" class="form-control mb-2" placeholder="Positions Needed (comma separated)" required aria-label="Positions Needed">
            <button type="submit" class="btn btn-primary">Add Project</button>
        </form>

        <h2 id="ongoing-collaborations">Ongoing Collaborations</h2>
        <ul id="ongoing-collab-list" class="list-group mb-4" aria-label="Ongoing Collaborations List"></ul>

        <h2 id="completed-collaborations">Completed Collaborations</h2>
        <ul id="completed-collab-list" class="list-group mb-4" aria-label="Completed Collaborations List"></ul>
    </div>
    <footer class="bg-dark text-white text-center py-3">
        <p>&copy; 2023 Collaboration Project Management</p>
    </footer>
</body>
</html>
